<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../css/font.css"/>
    <link rel="stylesheet" href="../css/xadmin.css"/>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="../lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/xadmin.js"></script>
    <script src="../js/global.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="../js/loginFilter.js"></script>
    <link rel="stylesheet" type="text/css" href="../js/easyui/themes/icon.css"/>
    <link rel="stylesheet" href="../js/easyui/themes/bootstrap/easyui.css" type="text/css" />
  </head>
  <script type="text/javascript">
  layui.use('laydate', function(){
    var laydate = layui.laydate;
    //执行一个laydate实例
    laydate.render({
      elem: '#beginUserCreateTime' ,//指定元素
	   type: 'datetime'
    });
	//执行一个laydate实例
	laydate.render({
	  elem: '#endUserCreateTime' ,//指定元素
	   type: 'datetime'
	});
  });
  </script>
  
  <script type="text/javascript">
	  var tokenId = globalData.getToken();
      $(function() {
        $("#userInfo").datagrid({
          method: 'post',
          url: globalData.server + 'users/findAll',//调用数据接口
		  queryParams: {
		  		tokenId: tokenId
		  				}
        });
       });
   
       function searchUsers() {
         $("#userInfo").datagrid('load',{
           userName:$("#userName").val(),
		   userPhone:$("#userPhone").val(),
		   beginUserCreateTime:$("#beginUserCreateTime").val(),
		   endUserCreateTime:$("#endUserCreateTime").val(),
		   userSex:$("#userSex").val(),
		   isLock:$("#isLock").val(),
           tokenId: tokenId
          }); 
       }
	
	/* 按钮 */
	function anniu(value, row, index){
	return "<a herf='javascript:void(0)' title='编辑' onclick='adminShow("+index+")'><i class='layui-icon'>&#xe642;</i></a>"
	+" <a title='删除' onclick='member_del("+index+")' href='javascript:void(0)'><i class='layui-icon'>&#xe640;</i>";
	}
 function adminShow(index){
 		//将当前行数据填入表单
 		var data = $("#userInfo").datagrid("getData"); //获取datagrid对应的json数据（对象集合）
 		var row = data.rows[index]; //获取第index行对应的json对象。 index为传递过来的索引参数，从0开始，就像数组下标。
 		var id=row.id;
 		var ind=layer.open({
 					type:2,
 					area:['600px','500px'],
 					offset:'100px',
 					shadeClose:true,
 					maxmin:true,
 					content:'user-edit.html',
 					success: function (layero, ind) {
							// 获取子页面的iframe
							var iframe = window['layui-layer-iframe' + ind];
							// 向子页面的全局函数child传参
							iframe.child(id);
 					     }
 				 });
 	}
 	/* 点击删除按钮时 */
 	function member_del(index){
 		layer.confirm('确定要删除此条信息吗?', {icon: 3, title:'提示'}, function(ind){
 			var data = $("#userInfo").datagrid("getData"); //获取datagrid对应的json数据（对象集合）
 			var row = data.rows[index]; //获取第index行对应的json对象。 index为传递过来的索引参数，从0开始，就像数组下标。
 			var id=row.id;
 		 $.post(globalData.server+"/users/deleteUser?id="+id,function(res){
 		     if(res==true){
 		 		layer.alert("删除成功", {icon: 6},function () {
 		 		     layer.close(index);
 		 			window.location.reload();
 		 		});
 		     }else{
 		         layer.alert("删除失败", {icon: 5},function () {
 		             // 获得frame索引
 		             var index = parent.layer.getFrameIndex(window.name);
 		             //关闭当前frame
 		             layer.close(index);
 		         });
 		     }
 		 },'json');
 		});
 	}
   </script>

  <body>
	  <div class="x-body">
	        <div class="layui-row">
	          <form class="layui-form layui-col-md12 x-so">
	           <div class="layui-inline">
	               <label class="layui-form-label">用户名称</label>
	               <div class="layui-inline">
	                   <input type="text" placeholder="请输入用户名称" name="userName" id="userName" class="layui-input">
	               </div>
	           </div>
			   
			   
			   <div class="layui-inline">
			       <label class="layui-form-label">手机号</label>
			       <div class="layui-inline">
			           <input type="text" placeholder="请输入手机号" name="userPhone" id="userPhone" class="layui-input">
			       </div>
			   </div>
			   
			   <div class="layui-inline">
			     <label class="layui-form-label">创建时间</label>
			     <input type="text" placeholder="yyyy-MM-dd" class="layui-input" id="beginUserCreateTime">
			     ~<input type="text" placeholder="yyyy-MM-dd" class="layui-input" id="endUserCreateTime">
			   </div>
			   
			   <div class="layui-input-inline">
			       <label class="layui-form-label">性别</label>
			       <div class="layui-input-inline">
			           <select id="userSex" name="userSex">
			               <option value="">请选择</option>
			               <option value="男">男</option>
			               <option value="女">女</option>
			           </select>
			       </div>
			   </div>
			   
			   <div class="layui-input-inline">
			       <label class="layui-form-label">用户锁定</label>
			       <div class="layui-input-inline">
			           <select id="isLock" name="isLock">
			               <option value="">请选择</option>
			               <option value="1">是</option>
			               <option value="0">否</option>
			           </select>
			       </div>
			   </div>
			  <!-- 
			   <div class="layui-input-inline">
			       <label class="layui-form-label">排序</label>
			       <div class="layui-input-inline">
			           <select id="orderBy" name="orderBy">
			               <option value="">请选择</option>
			               <option value="userName">用户名</option>
			               <option value="createTime">创建时间</option>
						   <option value="lastTime">最后一次登录时间</option>
			           </select>
			       </div>
			   </div> -->
	            <button class="layui-btn" type="button" onclick="searchUsers()"><i class="layui-icon">&#xe615;</i></button>
				<button class="layui-btn" onclick="refresh()" title="刷新">
				  <i class="layui-icon">ဂ</i></button>
	          </form>
	        </div>
	        <xblock>
	          <button class="layui-btn layui-btn-danger" onclick="delAll()"><i class="layui-icon"></i>批量删除</button>
	          <button class="layui-btn" onclick="x_admin_show('添加用户','user-add.html',600,400)"><i class="layui-icon"></i>添加</button>
	        </xblock>
  <div class="easyui-layout" id="productImgs_list">
    <table id="userInfo" class="easyui-datagrid" title="用户信息" data-options="rownumbers:true,height:'600px',width:'100%',fitColumns:false,pageSize:5,singleSelect:true,collapsible:true,pagination:true,pageList:[5,10,20],toolbar:'#datagridBtn'">
      <thead>
      <tr>
        <th data-options="field:'id',width:100,align:'center'"hidden="true"></th>
        <th data-options="field:'userName',title:'用户名',width:100,align:'center'"></th>
        <th data-options="field:'userSex',title:'性别',width:100,align:'center'"></th>
        <th data-options="field:'userAge',title:'年龄',width:100,align:'center'"></th>
        <th data-options="field:'userPhone',title:'手机号',width:100,align:'center'"></th>
        <th data-options="field:'userEmail',title:'邮箱',width:100,align:'center'"></th>
        <th data-options="field:'userImage',title:'头像',width:100,align:'center'"></th>
        <th data-options="field:'isSignIn',title:'是否签到',width:100,align:'center'"></th>
        <th data-options="field:'lastTime',title:'最后登录时间',width:100,align:'center'"></th>
        <th data-options="field:'createTime',title:'创建时间',width:100,align:'center'"></th>
		<th data-options="field:'isLock',title:'是否锁定',width:100,align:'center'"></th>
		<th data-options="field:'lockTime',title:'锁定时间',width:100,align:'center'"></th>
		<th data-options="field:'psdWrongTime',title:'密码错误次数',width:100,align:'center'"></th>
		<th data-options="field:'unLockTime',title:'解锁时间',width:100,align:'center'"></th>
        <th data-options="field:'roleId',title:'角色',width:100,align:'center'"></th>
		<th data-options="field:'caozuo',title:'操作',width:140,align:'center',formatter: anniu"></th>
      </tr>
      </thead> 
    </table>
  </div>
  </div>
  </body>

</html>
